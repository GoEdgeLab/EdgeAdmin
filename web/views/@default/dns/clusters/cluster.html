{$layout}

<first-menu>
	<menu-item :href="'/dns'">所有集群</menu-item>
	<span class="item">|</span>
	<menu-item :href="'/dns/clusters/cluster?clusterId=' + cluster.id" active="true">{{cluster.name}}</menu-item>
</first-menu>

<table class="ui table definition selectable">
	<tr>
		<td class="title">集群</td>
		<td><link-icon :href="'/clusters/cluster?clusterId=' + cluster.id">{{cluster.name}}</link-icon></td>
	</tr>
	<tr>
		<td>子域名</td>
		<td>
			<span v-if="dnsInfo.domainName.length > 0"><var>{{dnsInfo.dnsName}}</var>.{{dnsInfo.domainName}}</span>
			<span v-else class="disabled">没有设置</span>

			&nbsp; <a href="" @click.prevent="updateCluster(cluster.id)">[修改]</a>
		</td>
	</tr>
	<tr>
		<td>DNS服务商</td>
		<td>
			<div v-if="dnsInfo.providerName.length > 0">
				<link-icon :href="'/dns/providers/provider?providerId=' + dnsInfo.providerId">{{dnsInfo.providerTypeName}} - {{dnsInfo.providerName}}</link-icon>
			</div>
			<span v-else-if="dnsInfo.domainName.length == 0" class="disabled">请先设置域名</span>
			<span v-else class="disabled">没有设置</span>
		</td>
	</tr>
	<tr v-if="dnsInfo.domainName.length > 0">
		<td>操作</td>
		<td>
			<div v-if="!isSyncing">
				<link-red v-if="dnsHasChanges" @click.prevent="syncCluster(cluster.id)">检测到解析记录有变化，需要同步</link-red>
				<a href="" @click.prevent="syncCluster(cluster.id)" v-else>DNS服务商同步</a>
			</div>
			<span v-else>DNS服务商同步中...</span>
		</td>
	</tr>
</table>

<p class="comment">下面的DNS解析记录也可以手工在DNS服务商提供的管理平台添加。</p>

<h3>节点DNS解析记录 <span>&nbsp; ({{nodes.length}}个)</span></h3>
<p class="comment" v-if="nodes.length == 0">暂时没有需要设置的DNS记录。</p>
<table class="ui table selectable celled" v-if="nodes.length > 0">
	<thead>
		<tr>
			<th>节点</th>
			<th>子域名</th>
			<th>记录类型</th>
			<th>记录值</th>
			<th>线路</th>
            <th>状态</th>
			<th class="two op">操作</th>
		</tr>
	</thead>
	<tr v-for="node in nodes">
		<td><link-icon :href="'/clusters/cluster/node?clusterId=' + node.clusterId + '&nodeId=' + node.id">{{node.name}}</link-icon></td>
		<td>
			<span v-if="dnsInfo.dnsName.length > 0">{{dnsInfo.dnsName}}</span>
			<link-red v-else @click.prevent="updateCluster(cluster.id)">没有设置</link-red>
		</td>
		<td>A</td>
		<td>
			<span v-if="node.ipAddr.length > 0">{{node.ipAddr}}</span>
			<link-red title="点击设置" v-else @click.prevent="updateNode(node.id)">没有设置</link-red>
		</td>
		<td>
			<span v-if="node.route.code.length > 0">{{node.route.name}}</span>
			<link-red v-else title="点击设置" @click.prevent="updateNode(node.id)">没有设置</link-red>
		</td>
        <td>
            <span class="green" v-if="node.isResolved">已解析</span>
            <span v-else class="red">未解析</span>
        </td>
		<td>
			<link-popup @click.prevent="updateNode(node.id)">修改</link-popup>
		</td>
	</tr>
</table>

<h3>代理服务解析记录 <span>&nbsp; ({{servers.length}}个)</span></h3>
<p class="comment" v-if="servers.length == 0">暂时没有需要设置的DNS记录。</p>
<table class="ui table selectable celled" v-if="servers.length > 0">
	<thead>
		<tr>
			<th>服务</th>
			<th>子域名</th>
			<th>记录类型</th>
			<th>记录值</th>
            <th>状态</th>
		</tr>
	</thead>
	<tr v-for="server in servers">
		<td><link-icon :href="'/servers/server?serverId=' + server.id">{{server.name}}</link-icon> </td>
		<td>{{server.dnsName}}</td>
		<td>CNAME</td>
		<td>
			<span v-if="dnsInfo.domainName.length > 0"><var>{{dnsInfo.dnsName}}</var>.{{dnsInfo.domainName}}.</span>
			<link-red title="点击设置"  v-else @click.prevent="updateCluster(cluster.id)">没有设置</link-red>
		</td>
        <td>
            <span class="green" v-if="server.isResolved">已解析</span>
            <span v-else class="red">未解析</span>
        </td>
	</tr>
</table>